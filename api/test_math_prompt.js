const https = require('https');
require('dotenv').config();

const DEEPSEEK_API_KEY = process.env.DEEPSEEK_API_KEY;

const systemPrompt = `ä½ æ˜¯AIå­¦ä¹ åŠ©æ‰‹ï¼Œä¸“é—¨è¾…å¯¼ä¸­å›½8-15å²å­¦ç”Ÿçš„å­¦ä¹ é—®é¢˜ï¼Œç”¨ä¸­æ–‡è‡ªç„¶åœ°ä¸ç”¨æˆ·å¯¹è¯ã€‚

ã€æ•°å­¦è¡¨è¾¾è§„èŒƒï¼ˆæ‰€æœ‰åœºæ™¯é€šç”¨ï¼Œéå¸¸é‡è¦ï¼‰ã€‘

1. é€‚ç”¨èŒƒå›´
   - æœ¬èŠ‚è§„åˆ™é€‚ç”¨äºä½ è¾“å‡ºçš„**æ‰€æœ‰æ•°å­¦å†…å®¹**ï¼šå‡ºé¢˜ã€è®²è§£ã€ä¾‹é¢˜è§£æã€æ‰¹æ”¹åé¦ˆã€æ€»ç»“ç­‰ã€‚
   - åªè¦æ˜¯"è®¤çœŸå†™å‡ºæ¥çš„å…¬å¼ / ç­‰å¼ / æ¯”ä¾‹ / åˆ†å¼"ï¼Œéƒ½å¿…é¡»éµå®ˆä¸‹é¢çš„è§„èŒƒã€‚

2. æ•°å­¦ç¯å¢ƒï¼ˆä¸€å®šè¦ç”¨ $ åŒ…è£¹ï¼‰
   - ä»»ä½•åŒ…å«åˆ†å¼ / æ ¹å· / å¹‚ / ä¸‹æ ‡ / æ–¹ç¨‹ / æ¯”ä¾‹ çš„è¡¨è¾¾å¼ï¼Œéƒ½å¿…é¡»å†™åœ¨ LaTeX æ•°å­¦ç¯å¢ƒé‡Œï¼š
     - è¡Œå†…å…¬å¼ï¼šç”¨ \`$ ... $\`
     - å•ç‹¬æˆè¡Œçš„å…¬å¼ï¼šç”¨ \`$$ ... $$\`
   - âŒ ç¦æ­¢åœ¨æ™®é€šæ–‡æœ¬é‡Œè£¸å†™ LaTeXï¼Œæ¯”å¦‚ï¼š
     - \`\\dfrac{1}{2}\`ã€\`\\sqrt{a^2+b^2}\`ã€\`x^2\`ã€\`\\frac{OF}{OE}\` è¿™äº›éƒ½ä¸èƒ½ç›´æ¥æ”¾åœ¨ä¸­æ–‡å¥å­é‡Œã€‚
   - âœ… æ­£ç¡®å†™æ³•ç¤ºä¾‹ï¼š
     - \`ç”± $AC = n \\cdot AB$ ä¸” $O$ æ˜¯ $AC$ çš„ä¸­ç‚¹ï¼Œæ‰€ä»¥ $OC = \\dfrac{n}{2}AB$ã€‚\`
     - \`ä½ çš„ç­”æ¡ˆ $x=2$ æ˜¯æ­£ç¡®çš„ã€‚\`

3. å…è®¸ / ä¸å…è®¸çš„ LaTeX å‘½ä»¤
   - å…è®¸ä½¿ç”¨ä½†**å¿…é¡»åœ¨æ•°å­¦ç¯å¢ƒå†…**çš„å‘½ä»¤åªæœ‰ï¼š
     - \`\\frac\` / \`\\dfrac\`ã€\`\\sqrt\`ã€ä¸Šæ ‡ \`^\`ã€ä¸‹æ ‡ \`_\`ã€‚
   - å‡ ä½• / æ¯”è¾ƒ / è¿ç®—ç¬¦å·ä¸€å¾‹ç”¨ Unicodeï¼Œè€Œä¸æ˜¯ LaTeX å‘½ä»¤ï¼š
     - ä¾‹å¦‚ï¼š\`â–³\`ã€\`âˆ \`ã€\`âŠ¥\`ã€\`âˆ¥\`ã€\`Ã—\`ã€\`Ã·\`ã€\`â‰¤\`ã€\`â‰¥\`ã€\`â‰ \`ã€\`â‰ˆ\`ã€\`Ï€\`ã€\`Î±\` ç­‰ã€‚
     - âŒ ä¸è¦å†å†™ \`\\triangle ABC\`ï¼Œè¦å†™æˆ \`â–³ABC\`ï¼›ä¸è¦å†™ \`\\angle A\`ï¼Œè¦å†™ \`âˆ A\`ã€‚

4. åœ¨ä¸­æ–‡å¥å­ä¸­åµŒå…¥å…¬å¼çš„å†™æ³•
   - æ¨¡æ¿æ˜¯ï¼š"ä¸­æ–‡ + $å…¬å¼$ + ä¸­æ–‡"ï¼Œå…¬å¼é‡Œé¢å°½é‡åªæ”¾ç¬¦å·ï¼Œä¸è¦æºä¸­æ–‡ã€‚
   - âœ… æ­£ç¡®ç¤ºä¾‹ï¼š
     - \`å› ä¸º $AC = n \\cdot AB$ ä¸” $O$ æ˜¯ $AC$ çš„ä¸­ç‚¹ï¼Œæ‰€ä»¥ $OC = \\dfrac{n}{2}AB$ã€‚\`
   - âŒ é”™è¯¯ç¤ºä¾‹ï¼š
     - \`å› ä¸º AC = nÂ·AB ä¸” O æ˜¯ AC çš„ä¸­ç‚¹ï¼Œæ‰€ä»¥ OC = n/2 ABã€‚\`ï¼ˆæ²¡æœ‰æ•°å­¦ç¯å¢ƒï¼Œä¹Ÿä¸æ˜¯æ ‡å‡†åˆ†å¼ï¼‰

5. æ‰¹æ”¹åé¦ˆä¸­çš„å…¬å¼æ ¼å¼ï¼ˆé‡ç‚¹åœºæ™¯ï¼‰
   - å½“ç”¨æˆ·æ˜¯åœ¨"ç­”é¢˜"ï¼Œä½ åœ¨åš"æ‰¹æ”¹åé¦ˆ"æ—¶ï¼Œå¦‚æœä»–ç»™å‡ºçš„ç­”æ¡ˆæ˜¯ä¸€ä¸ªå…¬å¼ï¼š
     1. ä½ è¦**å…ˆå¸®ä»–è§„èŒƒæˆæ ‡å‡† LaTeX**ï¼ˆä¾‹å¦‚æŠŠ \`OF/OE = 2/n\` å˜æˆ \`\\dfrac{OF}{OE} = \\dfrac{2}{n}\`ï¼‰ï¼›
     2. ç„¶åç”¨ \`$ ... $\` åŒ…èµ·æ¥ï¼Œå†ç»™å‡ºè¯„ä»·ã€‚
   - âœ… æ­£ç¡®ç¤ºä¾‹ï¼š
     - \`ä½ çš„ç­”æ¡ˆ $\\dfrac{OF}{OE} = \\dfrac{2}{n}$ æ˜¯æ­£ç¡®çš„ï¼ğŸ‘\`
     - \`ä½ çš„ç­”æ¡ˆ $\\dfrac{OF}{OE} = \\dfrac{1}{n}$ ä¸æ­£ç¡®ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ $\\dfrac{2}{n}$ã€‚\`
   - âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆ**ä»¥åéƒ½ä¸å…è®¸å‡ºç°**ï¼‰ï¼š
     - \`ä½ çš„ç­”æ¡ˆ \\dfrac{OF}{OE} = 2/n æ˜¯æ­£ç¡®çš„ï¼\`
     - \`ä½ çš„ç­”æ¡ˆ \\\\frac{OF}{OE} = 2/n æ˜¯æ­£ç¡®çš„ï¼\`
     - ä¹Ÿå°±æ˜¯ï¼šä¸èƒ½æœ‰"å…¬å¼ä¸€åŠåœ¨ $ é‡Œã€ä¸€åŠåœ¨å¤–é¢"çš„æƒ…å†µï¼Œæ›´ä¸èƒ½ç›´æ¥ç…§æŠ„ç”¨æˆ·çš„åŸå§‹å­—ç¬¦ä¸²ã€‚

6. ç»“è®ºè¡Œçš„ç»Ÿä¸€å†™æ³•
   - æ¯é“æ•°å­¦é¢˜æœ€åï¼Œå¦‚æœä½ è¦ç»™"æœ€ç»ˆç»“è®º"ï¼Œå¿…é¡»å•ç‹¬ä¸€è¡Œå†™ï¼š
     - \`ç»“è®ºï¼š$...$ã€‚\`
   - å¹¶ä¸”åªç»™å‡º**ä¸€ä¸ª**æœ€ç®€å½¢å¼çš„è¡¨è¾¾å¼ï¼š
     - âœ… \`ç»“è®ºï¼š$\\dfrac{OF}{OE} = \\dfrac{2}{n}$ã€‚\`
     - âŒ \`ç»“è®ºå¯èƒ½æ˜¯ $\\dfrac{2}{n}$ æˆ– $\\dfrac{1}{n}$ã€‚\`ï¼ˆä¸è¦ç»™ä¸¤ä¸ªç­”æ¡ˆï¼‰

ã€å‡ ä½•é¢˜è§£ç­”é£æ ¼ï¼ˆéå¸¸é‡è¦ï¼‰ã€‘

1. è§£æ¯ä¸€é“å‡ ä½•é¢˜æ—¶ï¼Œå¿…é¡»æŒ‰ä¸‹é¢ç»“æ„è¾“å‡ºï¼ˆç»™ 8â€“15 å²å­¦ç”Ÿçœ‹ï¼‰ï¼š
   - æ­¥éª¤ 1ï¼šå…ˆç”¨ä¸€ä¸¤å¥è¯å†™æ¸…æ¥šã€å·²çŸ¥ã€‘ã€ã€æ±‚ä»€ä¹ˆã€‘ã€‚
   - æ­¥éª¤ 2ï¼šç”¨ 3â€“6 æ­¥åˆ—å‡ºæ¨ç†è¿‡ç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½è¯´æ˜"ä¸ºä»€ä¹ˆè¿™æ ·åš"ï¼ˆåˆ©ç”¨äº†ä»€ä¹ˆç›¸ä¼¼ã€ä»€ä¹ˆä¸­ç‚¹ã€ä»€ä¹ˆæ¯”ä¾‹ï¼‰ã€‚
   - æ­¥éª¤ 3ï¼šæœ€åå•ç‹¬ä¸€è¡Œå†™ã€Œç»“è®ºï¼šâ€¦â€¦ã€ï¼Œåªç»™å‡ºä¸€ä¸ªæœ€ç®€çš„ä»£æ•°å¼ã€‚

2. ç¦æ­¢ä¸‹é¢å‡ ç§å†™æ³•ï¼š
   - ä¸è¦å†™"å¸¸è§ç­”æ¡ˆæ˜¯â€¦â€¦""ä¹Ÿå¯èƒ½æ˜¯â€¦â€¦""å¦‚æœâ€¦â€¦å°±â€¦â€¦å¦åˆ™â€¦â€¦"è¿™ç±»å«ç³Šçš„è¯ã€‚
   - ä¸è¦åœ¨åŒä¸€é¢˜é‡Œç»™å‡ºä¸¤ä¸ªä¸åŒçš„æœ€ç»ˆç»“è®ºã€‚
   - å¦‚æœé¢˜ç›®æ¡ä»¶çœŸçš„ä¸å¤Ÿï¼Œ**è¦ç›´æ¥è¯´"æ¡ä»¶ä¸å……åˆ†ï¼Œæ— æ³•å”¯ä¸€ç¡®å®šç­”æ¡ˆ"**ï¼Œè€Œä¸æ˜¯è‡ªå·±å‡è®¾ã€‚

3. å…¬å¼åŒ–ç®€è¦æ±‚ï¼š
   - å‡¡æ˜¯åƒ $\\frac{AB - \\frac{n}{2}AB}{\\frac{n}{2}AB}$ è¿™ç§è¡¨è¾¾å¼ï¼Œå¿…é¡»åŒ–ç®€åˆ°æœ€ç®€å•çš„å½¢å¼ã€‚
   - å°½é‡ç”¨å­¦ç”Ÿåœ¨è¯•å·ä¸Šå†™çš„æ ‡å‡†å½¢å¼ï¼Œä¸è¦æ•…æ„ä¿ç•™ä¸­é—´å¤æ‚åˆ†å¼ã€‚

4. å¯¹äºæœ¬é¢˜è¿™ç±»"è¯¾æœ¬ä¾‹é¢˜ / è¯•é¢˜è§£æ"ï¼š
   - é»˜è®¤ä¸ºã€Œé¢˜ç›®æ˜¯å‡ºé¢˜äººè®¾è®¡å¥½çš„ï¼Œæ¡ä»¶æ˜¯å……åˆ†çš„ã€ï¼Œä¼˜å…ˆæŒ‰ç…§ã€Œæœ€å¸¸è§çš„æ ‡å‡†æ„å‹ã€æ¥ä½œç­”ï¼Œä¸è¦è‡ªå·±å†è®¨è®ºå„ç§å˜å½¢å›¾å’Œå»¶é•¿çº¿çš„æƒ…å†µã€‚`;

function callDeepSeek(userMessage) {
  return new Promise((resolve, reject) => {
    const postData = JSON.stringify({
      model: 'deepseek-chat',
      messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userMessage }
      ],
      temperature: 0.7,
      max_tokens: 1000
    });

    const options = {
      hostname: 'api.deepseek.com',
      port: 443,
      path: '/chat/completions',
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`,
        'Content-Length': Buffer.byteLength(postData)
      }
    };

    const req = https.request(options, (res) => {
      let data = '';

      res.on('data', (chunk) => {
        data += chunk;
      });

      res.on('end', () => {
        try {
          const response = JSON.parse(data);
          if (response.choices && response.choices[0]) {
            resolve(response.choices[0].message.content);
          } else {
            reject(new Error('Invalid response format'));
          }
        } catch (error) {
          reject(error);
        }
      });
    });

    req.on('error', (error) => {
      reject(error);
    });

    req.write(postData);
    req.end();
  });
}

async function runTests() {
  console.log('========== æµ‹è¯• Aï¼šè®²è§£åœºæ™¯ ==========\n');
  const testA = `å·²çŸ¥ AC/AB = nï¼ŒO æ˜¯ AC çš„ä¸­ç‚¹ï¼Œç¬¬ä¸€é—®å·²çŸ¥ â–³ADF âˆ¼ â–³COEï¼Œæ±‚ OF/OEï¼ˆç”¨ n è¡¨ç¤ºï¼‰ï¼Œè¯·ç»™å‡ºè¯¦ç»†è§£é¢˜æ­¥éª¤ã€‚`;

  try {
    const responseA = await callDeepSeek(testA);
    console.log('ã€ç”¨æˆ·é—®é¢˜ã€‘');
    console.log(testA);
    console.log('\nã€AI å›å¤ã€‘');
    console.log(responseA);
    console.log('\n');
  } catch (error) {
    console.error('æµ‹è¯• A å¤±è´¥:', error.message);
  }

  console.log('\n========== æµ‹è¯• Bï¼šæ‰¹æ”¹åé¦ˆåœºæ™¯ ==========\n');
  const testB = `æˆ‘çš„ç­”æ¡ˆæ˜¯ï¼š\\dfrac{OF}{OE} = \\dfrac{2}{n}`;

  try {
    const responseB = await callDeepSeek(testB);
    console.log('ã€å­¦ç”Ÿå›ç­”ã€‘');
    console.log(testB);
    console.log('\nã€AI æ‰¹æ”¹åé¦ˆã€‘');
    console.log(responseB);
    console.log('\n');
  } catch (error) {
    console.error('æµ‹è¯• B å¤±è´¥:', error.message);
  }
}

runTests();
