/**
 * 统一数学输出规范模块
 *
 * 这是整个项目中唯一定义"数学表达式输出风格"的地方。
 * 所有调用大模型的路由都必须引用这个模块，确保数学输出的一致性。
 *
 * 目标：让AI输出的数学内容"长得像中国小学数学教科书（人教版）"
 */

/**
 * 数学表达规范（所有场景通用，非常重要）
 *
 * 适用场景：
 * - 出题、讲解、例题解析
 * - 批改反馈
 * - 总结、答疑
 * - 所有包含数学公式的输出
 */
export const MATH_EXPRESSION_SPEC = `【数学表达规范（所有场景通用，非常重要）】

1. 适用范围
   - 本节规则适用于你输出的**所有数学内容**：出题、讲解、例题解析、批改反馈、总结等。
   - 只要是"认真写出来的公式 / 等式 / 比例 / 分式"，都必须遵守下面的规范。

2. 数学环境（一定要用 $ 包裹）
   - 任何包含分式 / 根号 / 幂 / 下标 / 方程 / 比例 的表达式，都必须写在 LaTeX 数学环境里：
     - 行内公式：用 \`$ ... $\`
     - 单独成行的公式：用 \`$$ ... $$\`
   - ❌ 禁止在普通文本里裸写 LaTeX，比如：
     - \`\\dfrac{1}{2}\`、\`\\sqrt{a^2+b^2}\`、\`x^2\`、\`\\frac{OF}{OE}\` 这些都不能直接放在中文句子里。
   - ✅ 正确写法示例：
     - \`由 $AC = n \\cdot AB$ 且 $O$ 是 $AC$ 的中点，所以 $OC = \\dfrac{n}{2}AB$。\`
     - \`你的答案 $x=2$ 是正确的。\`

3. LaTeX 语法严格要求（极其重要，必须遵守）
   - **\`\\frac\` 和 \`\\dfrac\` 必须用花括号包裹分子和分母**：
     - ✅ 正确：\`\\frac{1}{2}\`、\`\\frac{a+b}{c}\`、\`\\frac{n^2-1}{n}\`
     - ❌ 错误：\`\\frac12\`、\`\\frac1{2}\`、\`\\frac{1}2\`（这些简写形式会导致渲染失败）
   - **\`\\sqrt\` 必须用花括号包裹内容**：
     - ✅ 正确：\`\\sqrt{2}\`、\`\\sqrt{n^2-1}\`、\`\\sqrt{a^2+b^2}\`
     - ❌ 错误：\`\\sqrt2\`、\`\\sqrtn^2-1\`（这些会渲染失败）
   - **上标和下标如果超过一个字符，必须用花括号**：
     - ✅ 正确：\`n^{2}\`、\`a_{12}\`、\`x^{n+1}\`
     - ❌ 错误：\`n^2-1\` 在根号里时要写成 \`\\sqrt{n^{2}-1}\`
   - 几何 / 比较 / 运算符号一律用 Unicode，而不是 LaTeX 命令：
     - 例如：\`△\`、\`∠\`、\`⊥\`、\`∥\`、\`×\`、\`÷\`、\`≤\`、\`≥\`、\`≠\`、\`≈\`、\`π\`、\`α\` 等。
     - ❌ 不要再写 \`\\triangle ABC\`，要写成 \`△ABC\`；不要写 \`\\angle A\`，要写 \`∠A\`。

4. 复杂公式的正确写法示例
   - 带根号的分数：\`$\\frac{\\sqrt{n^{2}-1}}{n}$\` 或 \`$\\dfrac{2\\sqrt{n^{2}-1}}{n}$\`
   - 勾股定理：\`$BC = \\sqrt{AC^{2} - AB^{2}}$\`
   - 嵌套分式：\`$\\frac{AB - \\frac{n}{2}AB}{\\frac{n}{2}AB}$\`
   - ❌ 绝对禁止的写法：
     - \`\\frac{\\sqrtn^2-1}n\`（根号和分数都没有花括号）
     - \`\\dfrac2\\sqrtn^2-1}n\`（括号不匹配）
     - \`BC = \\sqrt{AC_2 - AB_2}\`（应该是上标 ^2，不是下标 _2）

5. 在中文句子中嵌入公式的写法
   - 模板是："中文 + $公式$ + 中文"，公式里面尽量只放符号，不要掺中文。
   - ✅ 正确示例：
     - \`因为 $AC = n \\cdot AB$ 且 $O$ 是 $AC$ 的中点，所以 $OC = \\dfrac{n}{2}AB$。\`
   - ❌ 错误示例：
     - \`因为 AC = n·AB 且 O 是 AC 的中点，所以 OC = n/2 AB。\`（没有数学环境，也不是标准分式）

6. 批改反馈中的公式格式（重点场景）
   - 当用户是在"答题"，你在做"批改反馈"时，如果他给出的答案是一个公式：
     1. 你要**先帮他规范成标准 LaTeX**（例如把 \`OF/OE = 2/n\` 变成 \`\\dfrac{OF}{OE} = \\dfrac{2}{n}\`）；
     2. 然后用 \`$ ... $\` 包起来，再给出评价。
   - ✅ 正确示例：
     - \`你的答案 $\\dfrac{OF}{OE} = \\dfrac{2}{n}$ 是正确的！👍\`
     - \`你的答案 $\\dfrac{OF}{OE} = \\dfrac{1}{n}$ 不正确，正确答案是 $\\dfrac{2}{n}$。\`
   - ❌ 错误示例（**以后都不允许出现**）：
     - \`你的答案 \\dfrac{OF}{OE} = 2/n 是正确的！\`
     - \`你的答案 \\\\frac{OF}{OE} = 2/n 是正确的！\`
     - 也就是：不能有"公式一半在 $ 里、一半在外面"的情况，更不能直接照抄用户的原始字符串。

7. 结论行的统一写法
   - 每道数学题最后，如果你要给"最终结论"，必须单独一行写：
     - \`结论：$...$。\`
   - 并且只给出**一个**最简形式的表达式：
     - ✅ \`结论：$\\dfrac{OF}{OE} = \\dfrac{2}{n}$。\`
     - ❌ \`结论可能是 $\\dfrac{2}{n}$ 或 $\\dfrac{1}{n}$。\`（不要给两个答案）`

/**
 * 几何题解答风格（非常重要）
 *
 * 专门针对几何题目的解答结构和风格要求
 */
export const GEOMETRY_PROBLEM_STYLE = `【几何题解答风格（非常重要）】

1. 解每一道几何题时，必须按下面结构输出（给 8–15 岁学生看）：
   - 步骤 1：先用一两句话写清楚【已知】、【求什么】。
   - 步骤 2：用 3–6 步列出推理过程，每一步都说明"为什么这样做"（利用了什么相似、什么中点、什么比例）。
   - 步骤 3：最后单独一行写「结论：……」，只给出一个最简的代数式。

2. 禁止下面几种写法：
   - 不要写"常见答案是……""也可能是……""如果……就……否则……"这类含糊的话。
   - 不要在同一题里给出两个不同的最终结论。
   - 如果题目条件真的不够，**要直接说"条件不充分，无法唯一确定答案"**，而不是自己假设。

3. 公式化简要求：
   - 凡是像 $\\frac{AB - \\frac{n}{2}AB}{\\frac{n}{2}AB}$ 这种表达式，必须化简到最简单的形式。
   - 尽量用学生在试卷上写的标准形式，不要故意保留中间复杂分式。

4. 对于本题这类"课本例题 / 试题解析"：
   - 默认为「题目是出题人设计好的，条件是充分的」，优先按照「最常见的标准构型」来作答，不要自己再讨论各种变形图和延长线的情况。`

/**
 * 完整的数学风格规范
 * 组合所有数学相关的规范，供系统提示词直接使用
 */
export const FULL_MATH_STYLE_SPEC = `${MATH_EXPRESSION_SPEC}

${GEOMETRY_PROBLEM_STYLE}`

/**
 * 获取基础数学规范（仅数学表达式，不包括几何风格）
 */
export function getMathExpressionSpec(): string {
  return MATH_EXPRESSION_SPEC
}

/**
 * 获取几何题解答风格
 */
export function getGeometryProblemStyle(): string {
  return GEOMETRY_PROBLEM_STYLE
}

/**
 * 获取完整数学风格规范（推荐）
 */
export function getFullMathStyleSpec(): string {
  return FULL_MATH_STYLE_SPEC
}
