#!/usr/bin/expect -f

set timeout 60

# 上传配置文件
spawn scp nginx-fixed-simple.conf root@120.24.22.244:/tmp/nginx.conf
expect "password:"
send "Lyc001286\r"
expect eof

# SSH连接并快速应用配置
spawn ssh root@120.24.22.244
expect "password:"
send "Lyc001286\r"
expect "root@*"

send "cp /tmp/nginx.conf /etc/nginx/nginx.conf\r"
expect "root@*"

send "nginx -t && systemctl reload nginx\r"
expect "root@*"

send "curl -s http://localhost/api/health\r"
expect "root@*"

send "exit\r"
expect eof