#!/usr/bin/expect -f
set timeout 30
set password "Lyc001286"

spawn ssh root@120.24.22.244
expect {
    "password:" {
        send "$password\r"
    }
}

expect "# "

puts "\n检查 Nginx 配置..."
send "nginx -T 2>&1 | grep -A 30 'location /api'\r"
expect "# "
sleep 3

puts "\n检查 Nginx 错误日志..."
send "tail -50 /var/log/nginx/error.log | grep -i 502\r"
expect "# "
sleep 2

send "exit\r"
expect eof
